<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta content="embed.png" property="og:image" />
    <link rel="stylesheet" href="style.css">
    <title>Config Generator</title>
</head>

<body>
    <img src="https://dunb17ur4ymx4.cloudfront.net/webstore/logos/155f177e7d0b21bb523faa40dfbb54fb4c81c18c.png" alt="Logo" class="logo">
    <div class="container">
        <h1>Config Generator</h1>
        <div class="dropdown-container">
            <label for="framework">Select Framework</label>
            <select id="framework" class="dropdown" onchange="updateSelected()">
                <option value="qb-core" selected>QB Core</option>
                <option value="esx">ESX</option>
                <option value="ox">OX Inventory</option>
                <option value="qs">Quasar Inventory (3.0+, QB)</option>
            </select>
        </div>
        <div class="dropdown-container">
            <label for="names">Select Weapons</label>
            <div id="names" class="dropdown checkbox-dropdown" onclick="toggleCheckboxDropdown()">Weapons</div>
            <div id="checkboxDropdownContent" class="checkbox-dropdown-content">
                <label><input type="checkbox" value="MK18" onchange="updateCheckedLabels()"> MK18</label>
                <label><input type="checkbox" value="Mutant" onchange="updateCheckedLabels()"> Mutant</label>
                <label><input type="checkbox" value="Virtus" onchange="updateCheckedLabels()"> Virtus</label>
                <label><input type="checkbox" value="M320" onchange="updateCheckedLabels()"> M320</label>
                <label><input type="checkbox" value="Tactical Sniper" onchange="updateCheckedLabels()"> Tactical Sniper</label>
                <label><input type="checkbox" value="AGC" onchange="updateCheckedLabels()"> AGC</label>
                <label><input type="checkbox" value="Shotgun 590" onchange="updateCheckedLabels()"> Shotgun 590</label>
                <label><input type="checkbox" value="Police M4" onchange="updateCheckedLabels()"> Police M4</label>
                <label><input type="checkbox" value="X19" onchange="updateCheckedLabels()"> X19</label>
                <label><input type="checkbox" value="Revolver" onchange="updateCheckedLabels()"> Revolver</label>
                <label><input type="checkbox" value="MB47" onchange="updateCheckedLabels()"> MB47</label>
                <label><input type="checkbox" value="R9" onchange="updateCheckedLabels()"> R9</label>
                <label><input type="checkbox" value="L80" onchange="updateCheckedLabels()"> L80</label>
                <label><input type="checkbox" value="KVR" onchange="updateCheckedLabels()"> KVR</label>
                <label><input type="checkbox" value="X17" onchange="updateCheckedLabels()"> X17</label>
                <label><input type="checkbox" value="X45" onchange="updateCheckedLabels()"> X45</label>
                <label><input type="checkbox" value="A45" onchange="updateCheckedLabels()"> A45</label>
                <label><input type="checkbox" value="ZKKnife" onchange="updateCheckedLabels()"> ZK Knife</label>
                <label><input type="checkbox" value="MI9" onchange="updateCheckedLabels()"> MI9</label>
                <label><input type="checkbox" value="KTB" onchange="updateCheckedLabels()"> KTB</label>
                <label><input type="checkbox" value="C36" onchange="updateCheckedLabels()"> C36</label>
                <label><input type="checkbox" value="2S" onchange="updateCheckedLabels()"> 2S</label>
                <label><input type="checkbox" value="2011" onchange="updateCheckedLabels()"> 2011</label>
                <label><input type="checkbox" value="P5" onchange="updateCheckedLabels()"> P5</label>
                <label><input type="checkbox" value="X17 Modular" onchange="updateCheckedLabels()"> X17 Modular</label>
            </div>
        </div>
        <div class="dropdown-container">
            <label for="generate">Options</label>
            <select id="generate" class="dropdown" onchange="updateSelectedConfig()">
                <option value="entire-config" selected>Generate Entire Config</option>
                <option value="only-weapon">Generate Only Weapon Code</option>
            </select>
        </div>
        <button class="submit-button" onclick="submitForm()">Generate</button>
    </div>
    <div id="downloadBox" class="download-box">
        <h2>Download Files</h2>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('config.lua')">Download qb-weapons/config.lua</button>
            &nbsp;
        </div>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('weapons.lua')">Download qb-core/shared/weapons.lua</button>
            &nbsp;
        </div>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('items.lua')">Download qb-core/shared/items.lua</button>
            &nbsp;
        </div>
        <div class="download-item">
            <button class="download-all-button" onclick="downloadAll()">Download All Files</button>
        </div>
    </div>
    <div id="downloadBoxESX" class="download-box">
        <h2>Download Files</h2>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('config.weapons.lua')">Download es_extended/config.weapons.lua</button>
            &nbsp;
        </div>
    </div>
    <div id="downloadBoxOX" class="download-box">
        <h2>Download Files</h2>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('ox_inventory/data/weapons.lua')">Download ox_inventory/data/weapons.lua</button>
            &nbsp;
        </div>
    </div>
    <div id="downloadBoxQS" class="download-box">
        <h2>Download Files</h2>
        <div class="download-item">
            <button class="download-button" onclick="downloadFile('qb-core/shared/items.lua')">Download qb-core/shared/items.lua</button>
            <button class="download-button" onclick="downloadFile('qb-core/shared/weapons.lua')">Download qb-core/shared/weapons.lua</button>
            <button class="download-button" onclick="downloadFile('qs-inventory\config\weapons.lua')">Download qs-inventory\ config\weapons.lua</button>
            &nbsp;
        </div>
    </div>
    <label class="disclaimer">Before adding any of these files into your server make sure to make backups of the files
        you will be editing or replacing.</label>
        <script src="mappings.js"></script>
        <script src="swm.js"></script>
        <script src="qbcore.js"></script>
        <script src="esx.js"></script>
    <script>
        function toggleCheckboxDropdown() {
            document.getElementById("checkboxDropdownContent").classList.toggle("show");
        }

        window.onclick = function (event) {
            const dropdown = document.getElementById("checkboxDropdownContent");
            const toggleButton = document.getElementById("names");

            if (!toggleButton.contains(event.target) && !dropdown.contains(event.target)) {
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        }

        let selectedValue = "qb-core"
        let selectedValueConfig = "entire-config"

        function updateSelected() {
            const dropdown = document.getElementById('framework');
            selectedValue = dropdown.value;
            console.log('Selected framework: ' + selectedValue);
        }
        document.addEventListener('DOMContentLoaded', updateSelected);

        function updateSelectedConfig() {
            const dropdown = document.getElementById('generate');
            selectedValueConfig = dropdown.value;
            console.log('Selected config: ' + selectedValueConfig);
        }
        document.addEventListener('DOMContentLoaded', updateSelectedConfig);

        function submitForm() {
            const downloadBox = document.getElementById("downloadBox");
            downloadBox.style.display = "none";
            if (selectedValue === "qb-core") {
                const downloadBox = document.getElementById("downloadBox");
                downloadBox.style.display = "block";
            } else if (selectedValue === "esx") {
                const downloadBox = document.getElementById("downloadBoxESX");
                downloadBox.style.display = "block";
            } else if (selectedValue === "ox") {
                const downloadBox = document.getElementById("downloadBoxOX");
                downloadBox.style.display = "block";
            } else if (selectedValue === "qs") {
                const downloadBox = document.getElementById("downloadBoxQS");
                downloadBox.style.display = "block";
            }
        }

        function updateCheckedLabels() {
            const checkboxes = document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]');
            checkboxes.forEach((checkbox) => {
                const label = checkbox.parentElement;
                if (checkbox.checked) {
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                }
            });
        }

        function downloadFile(fileName) {
            if (selectedValue === "qb-core") {
                let text = "";
                let attachments = "";

                if (fileName === 'weapons.lua') {
                    if (selectedValue === "qb-core") {
                        if (selectedValueConfig === "entire-config") {
                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            const formattedLuaEntries = selectedNames.flatMap(name => {
                                if (nameMappings[name]) {
                                    return nameMappings[name].map(entry => `\t['${entry.name}'] = { name = '${entry.name}', label = '${entry.label}', weapontype = '${entry.weapontype}', ammotype = '${entry.ammotype}', damagereason = '${entry.damagereason}' },`);
                                } else {
                                    return [];
                                }
                            }).join('\n');

                            text = weaponslua + `\n${formattedLuaEntries}\n}\n`;
                        } else if (selectedValueConfig === "only-weapon") {
                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            const formattedLuaEntries = selectedNames.flatMap(name => {
                                if (nameMappings[name]) {
                                    return nameMappings[name].map(entry => `\t['${entry.name}'] = { name = '${entry.name}', label = '${entry.label}', weapontype = '${entry.weapontype}', ammotype = '${entry.ammotype}', damagereason = '${entry.damagereason}' },`);
                                } else {
                                    return [];
                                }
                            }).join('\n');

                            text = `QBShared = QBShared or {}
        QBShared.Weapons = {\n${formattedLuaEntries}\n}\n`;
                        }
                    }

                } else if (fileName === 'items.lua') {
                    if (selectedValue === "qb-core") {
                        if (selectedValueConfig === "entire-config") {
                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            const formattedLuaEntries = selectedNames.flatMap(name => {
                                if (nameMappings[name]) {
                                    return nameMappings[name].map(entry => `\t${entry.name} = { name = '${entry.name}', label = '${entry.label}', weight = 1000, type = 'weapon', ammotype = '${entry.ammotype}', image = '${entry.image}', unique = true, useable = false, description =  '${entry.description}'},`);
                                } else {
                                    return [];
                                }
                            }).join('\n');

                            text = itemslua + `\n${formattedLuaEntries}\n}\n`;
                        } else if (selectedValueConfig === "only-weapon") {
                            // Gather selected names from checkboxes
                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            const formattedLuaEntries = selectedNames.flatMap(name => {
                                if (nameMappings[name]) {
                                    return nameMappings[name].map(entry => `\t${entry.name} = { name = '${entry.name}', label = '${entry.label}', weight = 1000, type = 'weapon', ammotype = '${entry.ammotype}', image = '${entry.image}', unique = true, useable = false, description =  '${entry.description}'},`);
                                } else {
                                    return [];
                                }
                            }).join('\n');

                            text = itemslua_attachments + `\n${formattedLuaEntries}\n}\n`;
                        }
                    }
                } else if (fileName === 'config.lua') {
                    if (selectedValue === "qb-core") {
                        if (selectedValueConfig === "entire-config") {
                            text = configlua;

                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            function processAttachmentEntry(entry) {
                                const section = entry.attachment + " = \\{";
                                const regex = new RegExp(section);
                                const position = text.search(regex);
                                if (position !== -1) {
                                    const closingBraceIndex = text.indexOf('}', position);
                                    if (closingBraceIndex !== -1) {
                                        const formattedEntry = `\t${entry.name} = '${entry.component}',\n`;
                                        text = text.slice(0, closingBraceIndex) + formattedEntry + text.slice(closingBraceIndex);
                                    }
                                }
                            }

                            selectedNames.forEach(name => {
                                let formattedLuaEntries = '';
                                if (nameMappings[name]) {
                                    formattedLuaEntries = nameMappings[name].map(entry => `\t${entry.name} = 0.15,`).join('\n');
                                }

                                // Insert durability entries
                                let position = text.indexOf('Config.DurabilityMultiplier = {') + 'Config.DurabilityMultiplier = {'.length;
                                let closingBraceIndex = text.indexOf('}', position);
                                if (closingBraceIndex !== -1) {
                                    text = text.slice(0, closingBraceIndex) + `${formattedLuaEntries}\n` + text.slice(closingBraceIndex);
                                }

                                // Process each attachment entry one by one
                                if (attachmentMappings[name]) {
                                    attachmentMappings[name].forEach(entry => {
                                        if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment
                                            processAttachmentEntry(entry);
                                        }
                                    });
                                }

                            });
                        } else if (selectedValueConfig === "only-weapon") {
                            text = configlua_attachments;

                            // Gather selected names from checkboxes
                            const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                                .map(checkbox => checkbox.value);

                            // Function to update and save text for each attachment entry
                            function processAttachmentEntry(entry) {
                                const section = entry.attachment + " = \\{";
                                const regex = new RegExp(section);
                                const position = text.search(regex);
                                if (position !== -1) {
                                    const closingBraceIndex = text.indexOf('}', position);
                                    if (closingBraceIndex !== -1) {
                                        const formattedEntry = `\t${entry.name} = '${entry.component}',\n`;
                                        text = text.slice(0, closingBraceIndex) + formattedEntry + text.slice(closingBraceIndex);
                                    }
                                }
                            }

                            // Iterate through each selected weapon and process its attachments
                            selectedNames.forEach(name => {
                                // Prepare the formatted Lua text for durability
                                let formattedLuaEntries = '';
                                if (nameMappings[name]) {
                                    formattedLuaEntries = nameMappings[name].map(entry => `\t${entry.name} = 0.15,`).join('\n');
                                }

                                // Insert durability entries
                                let position = text.indexOf('Config.DurabilityMultiplier = {') + 'Config.DurabilityMultiplier = {'.length;
                                let closingBraceIndex = text.indexOf('}', position);
                                if (closingBraceIndex !== -1) {
                                    text = text.slice(0, closingBraceIndex) + `${formattedLuaEntries}\n` + text.slice(closingBraceIndex);
                                }

                                // Process each attachment entry one by one
                                if (attachmentMappings[name]) {
                                    attachmentMappings[name].forEach(entry => {
                                        if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment
                                            processAttachmentEntry(entry);
                                        }
                                    });
                                }

                            });
                        }
                    }
                } else {
                    text = "Example text content for download.";
                }


                // Create a Blob from the text
                const blob = new Blob([text], { type: 'text/plain' });

                // Create a temporary anchor element for the download
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fileName;

                // Append the anchor element to the body
                document.body.appendChild(link);

                // Programmatically click the link to trigger the download
                link.click();

                // Remove the anchor element from the body
                document.body.removeChild(link);
            } else if (selectedValue === "esx") {
                if (fileName === 'config.weapons.lua') {
                    if (selectedValueConfig === "entire-config") {
                        let text = ""
                        const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                            .map(checkbox => checkbox.value);

                        // Function to update and save text for each attachment entry
                        function processAttachmentEntry(entry, text) {
                            const section = entry.attachment + " = \\{";
                            const regex = new RegExp(section);
                            const position = text.search(regex);
                            if (position !== -1) {
                                const closingBraceIndex = text.indexOf('}', position);
                                if (closingBraceIndex !== -1) {
                                    const formattedEntry = `\t${entry.name} = '${entry.component}',\n`;
                                    text = text.slice(0, closingBraceIndex) + formattedEntry + text.slice(closingBraceIndex);
                                }
                            }
                            return text;
                        }

                        // Create formatted Lua entries for selected weapons with components
                        const formattedLuaEntries = selectedNames.flatMap(name => {
                            if (nameMappings[name]) {
                                return nameMappings[name].map(entry => {
                                    const components = (attachmentMappings[name] || []).filter(att => att.attachment !== 'smallscope_attachment')
                                        .map(att => `{ name = '${att.attachment}', label = TranslateCap('component_${att.attachment}'), hash = '${att.component}' }`).join(', ');

                                    return `\t{ name = '${entry.name}', label = TranslateCap('${entry.name}'), components = { ${components} }},`;
                                });
                            } else {
                                return [];
                            }
                        }).join('\n');

                        // Insert durability entries
                        if (formattedLuaEntries) {
                            let position = text.indexOf('Config.DurabilityMultiplier = {') + 'Config.DurabilityMultiplier = {'.length;
                            let closingBraceIndex = text.indexOf('}', position);
                            if (closingBraceIndex !== -1) {
                                text = text.slice(0, closingBraceIndex) + `${formattedLuaEntries}\n` + text.slice(closingBraceIndex);
                            }
                        }

                        // Iterate through each selected weapon and process its attachments
                        selectedNames.forEach(name => {
                            if (attachmentMappings[name]) {
                                attachmentMappings[name].forEach(entry => {
                                    if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment
                                        text = processAttachmentEntry(entry, text);
                                    }
                                });
                            }
                        });


                        text = configweaponslua + `\n${formattedLuaEntries}
}`
                        const blob = new Blob([text], { type: 'text/plain' });

                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = fileName;

                        document.body.appendChild(link);

                        link.click();

                        document.body.removeChild(link);
                    } else if (selectedValueConfig === "only-weapon") {
                        let text = ""

                        const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                            .map(checkbox => checkbox.value);


                        function processAttachmentEntry(entry, text) {
                            const section = entry.attachment + " = \\{";
                            const regex = new RegExp(section);
                            const position = text.search(regex);
                            if (position !== -1) {
                                const closingBraceIndex = text.indexOf('}', position);
                                if (closingBraceIndex !== -1) {
                                    const formattedEntry = `\t${entry.name} = '${entry.component}',\n`;
                                    text = text.slice(0, closingBraceIndex) + formattedEntry + text.slice(closingBraceIndex);
                                }
                            }
                            return text;
                        }

                        const formattedLuaEntries = selectedNames.flatMap(name => {
                            if (nameMappings[name]) {
                                return nameMappings[name].map(entry => {
                                    const components = (attachmentMappings[name] || []).filter(att => att.attachment !== 'smallscope_attachment')
                                        .map(att => `{ name = '${att.attachment}', label = TranslateCap('component_${att.attachment}'), hash = '${att.component}' }`).join(', ');

                                    return `\t{ name = '${entry.name}', label = TranslateCap('${entry.name}'), components = { ${components} }},`;
                                });
                            } else {
                                return [];
                            }
                        }).join('\n');

                        if (formattedLuaEntries) {
                            let position = text.indexOf('Config.DurabilityMultiplier = {') + 'Config.DurabilityMultiplier = {'.length;
                            let closingBraceIndex = text.indexOf('}', position);
                            if (closingBraceIndex !== -1) {
                                text = text.slice(0, closingBraceIndex) + `${formattedLuaEntries}\n` + text.slice(closingBraceIndex);
                            }
                        }

                        selectedNames.forEach(name => {
                            if (attachmentMappings[name]) {
                                attachmentMappings[name].forEach(entry => {
                                    if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment
                                        text = processAttachmentEntry(entry, text);
                                    }
                                });
                            }
                        });

                        text = `Config.DefaultWeaponTints = {
    [0] = TranslateCap("tint_default"),
    [1] = TranslateCap("tint_green"),
    [2] = TranslateCap("tint_gold"),
    [3] = TranslateCap("tint_pink"),
    [4] = TranslateCap("tint_army"),
    [5] = TranslateCap("tint_lspd"),
    [6] = TranslateCap("tint_orange"),
    [7] = TranslateCap("tint_platinum"),
}

Config.Weapons = {\n${formattedLuaEntries}
}`

                        // Create a Blob from the text
                        const blob = new Blob([text], { type: 'text/plain' });

                        // Create a temporary anchor element for the download
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = fileName;

                        // Append the anchor element to the body
                        document.body.appendChild(link);

                        // Programmatically click the link to trigger the download
                        link.click();

                        // Remove the anchor element from the body
                        document.body.removeChild(link);
                    }
                }
            }

            else if (selectedValue === "ox") {
                if (fileName === 'ox_inventory/data/weapons.lua') {
                    let text = ""

                    const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                        .map(checkbox => checkbox.value);


                    function saveText(updatedText) {
                        console.log(updatedText); // Replace this with actual saving logic
                    }

                    // Function to update and save text for each attachment entry
                    function processAttachmentEntry(entry, text) {
                        const section = "";
                        const position = text.search(section);
                        if (position !== -1) {
                            const closingBraceIndex = text.indexOf('', position);
                            //if (closingBraceIndex !== -1) {
                                const formattedEntry = `\t${entry.name} = '${entry.component}',\n`;
                                text = text.slice(0, closingBraceIndex) + formattedEntry + text.slice(closingBraceIndex);
                                saveText(text); // Save after each component is added
                            //}
                        }
                        return text;
                    }

                    // Create formatted Lua entries for selected weapons with components
                    const formattedLuaEntries = selectedNames.flatMap(name => {
                        if (nameMappings[name]) {
                            return nameMappings[name].map(entry => {
                                const components = (attachmentMappings[name] || []).filter(att => att.attachment !== 'smallscope_attachment')
                                    .map(att => `{ name = '${att.attachment}', label = TranslateCap('component_${att.attachment}'), hash = '${att.component}' }`).join(', ');

                                return `\n['${entry.name.toUpperCase()}'] = {\n\tlabel = '${entry.name.replace("weapon_", "").toUpperCase().replace("_", " ")}',\n\tweight = 1600,\n\tdurability = 0.03, \n\tammoname = '${entry.ammotype}',\n\t \n},`;
                                
                            });
                        } else {
                            return [];
                        }
                    }).join('\n');

                    text = `${formattedLuaEntries.replaceAll("AMMO_RIFLE", "ammo-rifle").replaceAll("AMMO_PISTOL", "ammo-9").replaceAll("AMMO_SNIPER", "ammo-sniper").replaceAll("AMMO_SHOTGUN", "ammo-shotgun").replaceAll("AMMO_SMG", "ammo-9")}`

                    selectedNames.forEach(name => {
                        let componentCounters = {}; // Reset counters for each selected name
                        let previousEntryName = ""; // Track the previous entry name

                        if (attachmentMappings[name]) {
                            attachmentMappings[name].forEach(entry => {
                                if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment

                                    // Reset counters if the entry name changes
                                    if (entry.name !== previousEntryName) {
                                        componentCounters = {};
                                        previousEntryName = entry.name;
                                    }

                                    const componentType = entry.attachment
                                        .replace("_attachment", "")
                                        .replace("_", "")
                                        .replace(/\d+/g, ""); // Remove all numbers

                                    // Initialize or increment the counter for the component type
                                    if (!componentCounters[componentType]) {
                                        componentCounters[componentType] = 1;
                                    } else {
                                        componentCounters[componentType]++;
                                    }

                                    const labelNumber = componentCounters[componentType];

                                    // Format the label by removing numbers, adding the entry name, and the counter
                                    const formattedLabel = entry.name.replace("weapon_", "").replaceAll("_", " ").replace(/^./, str => str.toUpperCase()) + " " +
                                        entry.attachment
                                        .replace("_attachment", "")
                                        .replaceAll("_", "")
                                        .replace(/\d+/g, "") // Remove all numbers
                                        .replace(/^./, str => str.toUpperCase()) 
                                        + ` ${labelNumber}`; // Append the label number

                                    text += `\n['${entry.name.replace("weapon_", "")}_${entry.attachment.replace("_attachment", "")}'] = {\n\tlabel = '${formattedLabel}',\n\tweight = 200,\n\ttype = '${componentType}',\n\tclient = {\n\t\tcomponent = {'${entry.component}'},\n\t\tusetime = 2500\n\t}\n},`;

                                }
                            });
                        }
                    });

                    // Create a Blob from the text
                    const blob = new Blob([text], { type: 'text/plain' });

                    // Create a temporary anchor element for the download
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = fileName;

                    // Append the anchor element to the body
                    document.body.appendChild(link);

                    // Programmatically click the link to trigger the download
                    link.click();

                    // Remove the anchor element from the body
                    document.body.removeChild(link);
                }
            }
            // QS INVENTORY GEN
            else if (selectedValue === "qs") {
                // qb-core/shared/items.lua
                if (fileName === 'qb-core/shared/items.lua') {
                    let text = ""
                    /*
                        ['weapon_g45'] 			 		= {['name'] = 'weapon_g45', 		 	  	     ['label'] = 'Glock 45', 			    ['weight'] = 1000, 		['type'] = 'weapon', 	['ammotype'] = 'AMMO_PISTOL',					['image'] = 'weapon_g45.png', 		        		['unique'] = true, 		['useable'] = false, 	['description'] = 'A small firearm designed for close combat'},

                        ['markomods-glock45-mag1'] 	     	 = {['name'] = 'markomods-glock45-mag1', 		['label'] = 'g45_clip1', 			['weight'] = 1000, 		['type'] = 'item', 		['image'] = 'pistol_extendedclip.png', 					['unique'] = false, 		['useable'] = true, 	['shouldClose'] = true,	   ['combinable'] = nil,   ['description'] = 'Pistol Clip'},
                    */
                    const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                        .map(checkbox => checkbox.value);

                    const formattedLuaEntries = selectedNames.flatMap(name => {
                        if (nameMappings[name]) {
                            return nameMappings[name].map(entry => {
                                const components = (attachmentMappings[name] || []).filter(att => att.attachment !== 'smallscope_attachment').join(', ');

                                return `\n['${entry.name}'] = {\n\t['name'] = '${entry.name}',\n\t['label'] = '${entry.name.replace("weapon_", "").toUpperCase().replace("_", " ")}',\n\t['weight'] = 1000,\n\t['type'] = 'weapon',\n\t['ammotype'] = '${entry.ammotype}',\n\t['image'] = '${entry.name}.png',\n\t['unique'] = true,\n\t['useable'] = false,\n\t['description'] = '${entry.name.replace("weapon_", "").toUpperCase().replace("_", " ")}'\n},`;
                                
                            });
                        } else {
                            return [];
                        }
                    }).join('\n');

                    text = `${formattedLuaEntries}`

                    const capitalizeWords = (str) => {
                        return str
                            .split(' ')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                            .join(' ');
                    };

                    text += "\n"

                    // Loop through each selected name for WeaponAttachments
                    selectedNames.forEach(name => {
                        if (nameMappings[name]) {
                            nameMappings[name].forEach(entry => {
                                // Get the attachment mappings for the specific entry
                                const weaponAttachments = attachmentMappings[name] || [];
                                let componentCounters = {}; // Reset counters for each selected weapon
                                let previousEntryName = ""; // Track the previous entry name

                                weaponAttachments.forEach(att => {
                                    if (att.attachment !== 'smallscope_attachment' && att.name === entry.name) { // Filter out smallscope_attachment and match entry name

                                        // Reset counters if the entry name changes
                                        if (att.name.toUpperCase() !== previousEntryName) {
                                            componentCounters = {};
                                            previousEntryName = att.name.toUpperCase();
                                        }

                                        const componentType = att.attachment
                                            .replace("_attachment", "")
                                            .replace("_", "")
                                            .replace(/\d+/g, ""); // Remove all numbers

                                        // Initialize or increment the counter for the component type
                                        if (!componentCounters[componentType]) {
                                            componentCounters[componentType] = 1;
                                        } else {
                                            componentCounters[componentType]++;
                                        }

                                        const labelNumber = componentCounters[componentType];

                                        // Format the label using att.attachment
                                        const formattedLabel = capitalizeWords(
                                            att.attachment
                                                .replace(/_/g, " ")      // Replace underscores with spaces
                                                .replace(/\d+/g, "")     // Remove all numbers
                                                .trim()                  // Trim any whitespace
                                        ) + ` ${labelNumber}`;           // Append the label number

                                        const itemName = `${att.name.replace("weapon_", "").toLowerCase()}-${componentType}${labelNumber}`;

                                        // Add the item in the required format
                                        text += `['${itemName}'] = {\n`;
                                        text += `    ['name'] = '${itemName}',\n`;
                                        text += `    ['label'] = '${att.name.replace("weapon_", "").replace(/^\w+/, (match) => match.charAt(0).toUpperCase() + match.slice(1))} ${formattedLabel.replace("Attachment ", "")}',\n`;
                                        text += `    ['weight'] = 1000,\n`;
                                        text += `    ['type'] = 'item',\n`;
                                        text += `    ['image'] = '${itemName}.png',\n`;
                                        text += `    ['unique'] = false,\n`;
                                        text += `    ['useable'] = true,\n`;
                                        text += `    ['shouldClose'] = true,\n`;
                                        text += `    ['combinable'] = nil,\n`;
                                        text += `    ['description'] = '${formattedLabel.replace(/\d+/g, "").trimEnd()}',\n`;
                                        text += `},\n`;
                                    }
                                });
                            });
                        }
                    });



                    const blob = new Blob([text], { type: 'text/plain' });

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);









                    // qb-core/shared/weapons.lua
                } else if (fileName === 'qb-core/shared/weapons.lua') {
                    let text = ""
                    /*
                        [`weapon_ak47`] = {
                            ['name'] = 'weapon_ak47',
                            ['label'] = 'AK47',
                            ['ammotype'] = 'AMMO_RIFLE',
                            ['damagereason'] = 'Ended / Rifled / Shot down / Floored'
                        },

                        [`weapon_g45`] 		     		 = {['name'] = 'weapon_g45', 	    ['label'] = 'Glock_45', 		['ammotype'] = 'AMMO_PISTOL',	['damagereason'] = 'Ended / Rifled / Shot down / Floored'},

                    */

                    const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                        .map(checkbox => checkbox.value);

                    
                    // This generates the weapon code
                    const formattedLuaEntries = selectedNames.flatMap(name => {
                        if (nameMappings[name]) {
                            return nameMappings[name].map(entry => {
                                return `\n[\`${entry.name}\`] = {\n\t['name'] = '${entry.name}',\n\t['label'] = '${entry.name.replace("weapon_", "").toUpperCase().replace("_", " ")}',\n\t['ammotype'] = '${entry.ammotype}',\n\t['damagereason'] = 'Ended / Rifled / Shot down / Floored'\n},`;
                            });
                        } else {
                            return [];
                        }
                    }).join('\n');


                    text = `${formattedLuaEntries}`

                    /*
                    // This generates the attachments
                    selectedNames.forEach(name => {
                        let componentCounters = {}; // Reset counters for each selected name
                        let previousEntryName = ""; // Track the previous entry name

                        if (attachmentMappings[name]) {
                            attachmentMappings[name].forEach(entry => {
                                if (entry.attachment !== 'smallscope_attachment') { // Filter out smallscope_attachment

                                    // Reset counters if the entry name changes
                                    if (entry.name !== previousEntryName) {
                                        componentCounters = {};
                                        previousEntryName = entry.name;
                                    }

                                    const componentType = entry.attachment
                                        .replace("_attachment", "")
                                        .replace("_", "")
                                        .replace(/\d+/g, ""); // Remove all numbers

                                    // Initialize or increment the counter for the component type
                                    if (!componentCounters[componentType]) {
                                        componentCounters[componentType] = 1;
                                    } else {
                                        componentCounters[componentType]++;
                                    }

                                    const labelNumber = componentCounters[componentType];

                                    // Format the label by removing numbers, adding the entry name, and the counter
                                    const formattedLabel = entry.name.replace("weapon_", "").replaceAll("_", " ").replace(/^./, str => str.toUpperCase()) + " " +
                                        entry.attachment
                                        .replace("_attachment", "")
                                        .replaceAll("_", "")
                                        .replace(/\d+/g, "") // Remove all numbers
                                        .replace(/^./, str => str.toUpperCase()) 
                                        + ` ${labelNumber}`; // Append the label number

                                    text += `\n['${entry.name.replace("weapon_", "")}_${entry.attachment.replace("_attachment", "")}'] = {\n\tlabel = '${formattedLabel}',\n\tweight = 200,\n\ttype = '${componentType}',\n\tclient = {\n\t\tcomponent = {'${entry.component}'},\n\t\tusetime = 2500\n\t}\n},`;
                                }
                            });
                        }
                    });
                    */
                    // \n${formattedLuaEntries}

                    const blob = new Blob([text], { type: 'text/plain' });

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else if (fileName === 'qs-inventory\config\weapons.lua') {
                    let text = "";

                    const selectedNames = Array.from(document.querySelectorAll('#checkboxDropdownContent input[type="checkbox"]:checked'))
                        .map(checkbox => checkbox.value);

                    // Initialize the text for Config.DurabilityMultiplier and Config.WeaponAttachments
                    text = "Config.DurabilityMultiplier = {\n";

                    // Loop through each selected name to add the durability multiplier
                    selectedNames.forEach(name => {
                        if (nameMappings[name]) {
                            // Map through each entry to access entry.name
                            nameMappings[name].forEach(entry => {
                                // Add the durability multiplier for each weapon
                                text += `    ['${entry.name.toLowerCase().replace(/ /g, "_")}'] = 0.10,\n`;
                            });
                        }
                    });

                    text += "}\n\n"; // Close the DurabilityMultiplier section and add a line break

                    // Add the WeaponAttachments section
                    text += "Config.WeaponAttachments = {\n";

                    const capitalizeWords = (str) => {
                        return str
                            .split(' ')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                            .join(' ');
                    };

                    let weaponAttachmentItems = [];


                    // Loop through each selected name for WeaponAttachments
                    selectedNames.forEach(name => {
                        if (nameMappings[name]) {
                            nameMappings[name].forEach(entry => {
                                // Start the weapon entry with the name in uppercase and underscores intact
                                text += `    ['${entry.name.toUpperCase()}'] = {\n`;

                                // Get the attachment mappings for the specific entry
                                const weaponAttachments = attachmentMappings[name] || [];
                                let componentCounters = {}; // Reset counters for each selected weapon
                                let previousEntryName = ""; // Track the previous entry name

                                weaponAttachments.forEach(att => {
                                    if (att.attachment !== 'smallscope_attachment' && att.name === entry.name) { // Filter out smallscope_attachment and match entry name

                                        // Reset counters if the entry name changes
                                        if (att.name.toUpperCase() !== previousEntryName) {
                                            componentCounters = {};
                                            previousEntryName = att.name.toUpperCase();
                                        }

                                        const componentType = att.attachment
                                            .replace("_attachment", "")
                                            .replace("_", "")
                                            .replace(/\d+/g, ""); // Remove all numbers

                                        // Initialize or increment the counter for the component type
                                        if (!componentCounters[componentType]) {
                                            componentCounters[componentType] = 1;
                                        } else {
                                            componentCounters[componentType]++;
                                        }

                                        const labelNumber = componentCounters[componentType];

                                        // Format the label using att.attachment
                                        const formattedLabel = capitalizeWords(
                                            att.attachment
                                                .replace(/_/g, " ")      // Replace underscores with spaces
                                                .replace(/\d+/g, "")     // Remove all numbers
                                                .trim()                  // Trim any whitespace
                                        ) + ` ${labelNumber}`;           // Append the label number

                                        const itemName = `${att.name.replace("weapon_", "").toLowerCase()}-${componentType}${labelNumber}`;
                                        const attachmentName = `${componentType}${labelNumber}`;

                                        // Add a comment for each component type section
                                        if (labelNumber === 1) {
                                            text += `        -- ${componentType.charAt(0).toUpperCase() + componentType.slice(1)}\n`;
                                        }

                                        // Create the component entry in the specified format
                                        text += `        ${componentType}${labelNumber} = {\n`;
                                        text += `            component = '${att.component}',\n`;
                                        text += `            item = '${itemName}',\n`;
                                        if (componentType === "clip") {
                                            text += `            type = 'clip',\n`;
                                        }
                                        text += `        },\n`;
                                        weaponAttachmentItems.push({
                                            item: itemName,
                                            attachment: attachmentName,
                                            type: componentType === "clip" ? "clip" : componentType
                                        });
                                    }
                                });
                                text += `    },\n`;
                            });
                        }
                    });
                    text += "}\n\n";

                    // Generate Config.WeaponAttachmentItems dynamically
                    text += "Config.WeaponAttachmentItems = {\n";
                    weaponAttachmentItems.forEach(att => {
                        text += `    {\n`;
                        text += `        item = '${att.item}',\n`;
                        text += `        attachment = '${att.attachment}',\n`;
                        text += `        type = '${att.type}'\n`;
                        text += `    },\n`;
                    });
                    text += "}\n";


                    // \n${formattedLuaEntries}

                    const blob = new Blob([text], { type: 'text/plain' });

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }

        


        function downloadAll() {
            // Logic for downloading all files
            downloadFile('weapons.lua');
            downloadFile('items.lua');
            downloadFile('config.lua');
        }

    </script>

</body>

</html>